<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Example</title>
  </head>
  <style>
    html,
    body {
      width: 100%;
      height: 100%;
      padding: 0;
      margin: 0;
    }
    video {
      width: 100%;
      height: 100%;
    }
    #video-con1 {
      display: inline-block;
      border: 1px solid #ddd;
      box-sizing: border-box;
      background: #c2c2c2;
    }
    #video-con2 {
      display: inline-block;
      border: 1px solid #ddd;
      background: #ddd;
      box-sizing: border-box;
      width: 40%;
      height: 40%;
    }
    @media screen and (min-width: 901px) {
      #video-con1 {
        width: 40%;
        height: 40%;
      }
    }
    @media screen and (max-width: 900px) {
      #video-con1 {
        width: 100%;
        height: 70%;
      }
      #video-con2 {
        position: fixed;
        top: 0px;
        right: 0px;
      }
    }
  </style>
  <body>
    <div id="video-con1"></div>
    <div id="video-con2"></div>
    <div>
      <button onclick="initSDK()">init SDK</button>
      <button onclick="checkWebRTC()">checkWebRTC</button>
      <button onclick="checkCamera()">checkCamera</button>
      <button onclick="checkMicrophone()">checkMicrophone</button>
      <button onclick="joinRoom()">joinRoom</button>
      <button onclick="enableCamera()">enableCamera</button>
      <button onclick="enableMic()">enableMic</button>
      <button onclick="leaveRoom()">leaveRoom</button>
      <button onclick="subscribe()">subscribe</button>
      <button onclick="sendMessage()">sendMessage</button>
    </div>
    <script src="./ZegoExpressManager.js"></script>
    <!-- <script src="./index.js"></script> -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.0/firebase-app.js";
      import {
        getMessaging,
        onMessage,
        getToken,
      } from "https://www.gstatic.com/firebasejs/9.8.0/firebase-messaging.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBVQe2tZ-LieqpPJ7lYV1UgFOKpFaALVwg",
        authDomain: "choui-zego-call.firebaseapp.com",
        projectId: "choui-zego-call",
        storageBucket: "choui-zego-call.appspot.com",
        messagingSenderId: "342421168483",
        appId: "1:342421168483:web:461ecd1a46fc0945553356",
        measurementId: "G-Y62X594ZRM",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const messaging = getMessaging(app);

      // Handle incoming messages. Called when:
      // - a message is received while the app has focus
      // - the user clicks on an app notification created by a service worker
      //   `messaging.onBackgroundMessage` handler.
      onMessage(messaging, (payload) => {
        console.warn("Message received. ", payload);
        // Update the UI to include the received message.
      });

      window.subscribe = function () {
        getToken(messaging, {
          vapidKey:
            "BMcmvf_6KuPeAC2VtLaAsMpSq1FFKW6L4a6vBYgUleClINzZLJ-Q06IBweY8I47B2_4-YT3kOaAYQd6ukizbaE8",
        })
          .then((currentToken) => {
            if (currentToken) {
              window.localStorage.setItem("web_push_token", currentToken);
            } else {
              // Show permission request.
              console.log(
                "No registration token available. Request permission to generate one."
              );
              // Show permission UI.
              requestPermission();
            }
          })
          .catch((err) => {
            console.log("An error occurred while retrieving token. ", err);
          });
      };

      window.requestPermission = function () {
        console.log("Requesting permission...");
        Notification.requestPermission().then((permission) => {
          if (permission === "granted") {
            console.log("Notification permission granted.");
            // TODO(developer): Retrieve a registration token for use with FCM.
            // In many cases once an app has been granted notification permission,
            // it should update its UI reflecting this.
            getToken();
          } else {
            console.log("Unable to get permission to notify.");
          }
        });
      };

      window.sendMessage = function () {
        var key =
          "AAAAT7nkYWM:APA91bF-M3fCcorPUDM-yC9RHCSsiVoKpther5C_kHp-hsjdgqeZ7M8IrzgH-TKncFoVPdthLuS6QfGWOXFk6MwfoxK0cSteDc0RVUhamXUHW1mK9N-BRSKnp7YOcBxxEEYHLH6YZZmL";
        var to = window.localStorage.getItem("web_push_token") || undefined;
        var notification = {
          title: "Portugal vs. Denmark",
          body: "5 to 1",
          icon: "firebase-logo.png",
          click_action: "http://localhost:8081",
        };

        to &&
          fetch("https://fcm.googleapis.com/fcm/send", {
            method: "POST",
            headers: {
              Authorization: "key=" + key,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              notification: notification,
              to: to,
            }),
          })
            .then(function (response) {
              console.log(response);
            })
            .catch(function (error) {
              console.error(error);
            });
      };
    </script>
  </body>
</html>
